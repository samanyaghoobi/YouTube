
# آموزش کامل دریافت SSL از کلودفلر و استفاده از CDN کلودفلر و اتصال آن به پنل مرزبان

سلام دوستان! 👋 در این آموزش قصد داریم نحوه‌ی دریافت گواهی SSL از کلودفلر، تنظیم CDN کلودفلر و اتصال آن به پنل مرزبان رو به‌صورت کامل بررسی کنیم. آماده‌اید؟ بزن بریم! 🚀

## مرحله ۱: ایجاد حساب کاربری در کلودفلر

1. وارد وبسایت [Cloudflare](https://www.cloudflare.com) بشید.
2. روی دکمه‌ی **Sign Up** کلیک کنید و فرم ثبت‌نام رو تکمیل کنید.
3. پس از ایجاد حساب کاربری، وارد حساب خود شوید.

## مرحله ۲: افزودن دامنه به کلودفلر

1. پس از ورود، روی گزینه **Add a Site** کلیک کنید.
2. نام دامنه‌ای که می‌خواهید از طریق کلودفلر مدیریت کنید رو وارد کنید و روی **Add Site** کلیک کنید.
3. پلن رایگان رو انتخاب کنید و ادامه بدید.

## مرحله ۳: تغییر Nameserverهای دامنه

1. در این مرحله، کلودفلر به شما Nameserverهای جدیدی ارائه می‌ده که باید اونا رو در پنل مدیریت دامنه‌تون تنظیم کنید.
2. وارد پنل مدیریتی دامنه بشید (مثلاً اگر دامنه رو از ایرنیک یا هر سایت دیگری خریداری کردید) و Nameserverهای قدیمی رو با Nameserverهای کلودفلر جایگزین کنید.
3. پس از تغییر Nameserverها، چند ساعت زمان می‌بره تا دامنه شما از طریق کلودفلر مدیریت بشه.

## مرحله ۴: تنظیمات SSL در کلودفلر

1. بعد از اضافه کردن دامنه، وارد داشبورد کلودفلر بشید و روی **SSL/TLS** کلیک کنید.
2. نوع SSL رو روی **Full** تنظیم کنید.
3. گزینه **Always Use HTTPS** رو فعال کنید تا تمامی ترافیک به HTTPS هدایت بشه.

## مرحله ۵: دریافت گواهینامه SSL

1. در بخش **SSL/TLS** به **Origin Server** برید.
2. روی **Create Certificate** کلیک کنید.
3. گزینه **Let Cloudflare generate a private key and CSR** رو انتخاب کنید و سپس روی **Next** کلیک کنید.
4. کلودفلر به شما یک گواهینامه و کلید خصوصی ارائه می‌ده. این مقادیر رو کپی کرده و ذخیره کنید (در فایل‌های متنی امن).

## مرحله ۶: نصب گواهینامه SSL در سرور مرزبان

1. وارد سرور بشید و به دایرکتوری مناسب برای ذخیره گواهینامه‌ها برید (مثلاً `/var/lib/marzban/certs/`).
2. دو فایل ایجاد کنید: یکی برای گواهی (مثلاً `cert.pem`) و دیگری برای کلید خصوصی (مثلاً `key.pem`).
3. محتوای گواهی کلودفلر رو در فایل `cert.pem` و محتوای کلید خصوصی رو در فایل `key.pem` ذخیره کنید.

   ```bash
   sudo nano /var/lib/marzban/certs/cert.pem
   sudo nano /var/lib/marzban/certs/key.pem
   ```

4. فایل‌ها رو ذخیره کنید و از ویرایشگر خارج بشید.

## مرحله ۷: پیکربندی پنل مرزبان برای استفاده از SSL

1. به دایرکتوری نصب مرزبان برید:
   ```bash
   cd /opt/marzban/
   ```
2. فایل پیکربندی Docker Compose مرزبان رو باز کنید و بخش SSL رو تنظیم کنید تا به مسیر فایل‌های `cert.pem` و `key.pem` اشاره کنه.
3. برای اعمال تغییرات، Docker Compose رو دوباره راه‌اندازی کنید:

   ```bash
   docker compose down
   docker compose up -d
   ```

## مرحله ۸: فعال‌سازی CDN کلودفلر

1. به داشبورد کلودفلر برگردید و به بخش **DNS** برید.
2. مطمئن بشید که علامت ابر نارنجی (فعال‌سازی CDN) در کنار رکوردهای A و CNAME مربوط به دامنه شما روشن است. این کار باعث می‌شه ترافیک از طریق CDN کلودفلر عبور کنه.

## جمع‌بندی

تبریک می‌گم! 🎉 حالا سرور شما از طریق SSL کلودفلر محافظت می‌شه و ترافیک شما از CDN کلودفلر عبور می‌کنه، که هم امنیت و هم سرعت اتصال رو افزایش می‌ده. اگر سوالی داشتید، حتماً در بخش نظرات بپرسید. تا آموزش بعدی، بدرود! 👋

---

<!-- پیشنهادات برای ادیت و جلوه‌های ویژه:

- **مقدمه:** شروع با یک مقدمه کوتاه و انرژی‌بخش.
- **نکات مهم:** در حین نمایش دستورات، بخش‌های مهم و حساس رو هایلایت کنید.
- **توضیحات تکمیلی:** استفاده از تصاویر یا انیمیشن‌های ساده برای توضیح مراحل.
- **جمع‌بندی:** نمایش یک چک‌لیست از مراحل انجام‌شده به‌صورت گرافیکی.
- **تعامل با مخاطب:** درخواست از مخاطب برای پرسش در کامنت‌ها و تشویق به اشتراک‌گذاری. -->